/*
 FrOSCon 2011 Animation
 
 Writen for the LoL Shield, designed by Jimmie Rodgers:
 http://jimmieprodgers.com/kits/lolshield/
 
 This needs the Charliplexing library, which you can get at the
 LoL Shield project page: http://code.google.com/p/lolshield/
 
 Created by Jimmie Rodgers on 12/30/2009.
 Adapted from: http://www.arduino.cc/playground/Code/BitMath
 
 History:
  	August 20, 2011 - Animation created for FrOSCon 2011
        December 30, 2009 - V1.0 first version written at 26C3/Berlin

  This is free software; you can redistribute it and/or
  modify it under the terms of the GNU Version 3 General Public
  License as published by the Free Software Foundation; 
  or (at your option) any later version.

  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public
  License along with this library; if not, write to the Free Software
  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
*/

#include <avr/pgmspace.h>  //AVR library for writing to ROM
#include <Charliplexing.h> //Imports the library, which needs to be
                           //Initialized in setup.

int blinkdelay = 100;      //Sets the time each frame is shown

/*
The BitMap array is what contains the frame data. Each line is one full frame.
Since each number is 16 bits, we can easily fit all 14 LEDs per row into it.
The number is calculated by adding up all the bits, starting with lowest on
the left of each row. 18000 was chosen as the kill number, so make sure that
is at the end of the matrix, or the program will continue to read into memory.

Here PROGMEM is called, which stores the array into ROM, which leaves us
with our RAM. You cannot change the array during run-time, only when you
upload to the Arduino. You will need to pull it out of ROM, which is covered
below. If you want it to stay in RAM, just delete PROGMEM
*/
uint16_t BitMap[][9] PROGMEM = {
//Frog Logo
{0,0,0,0,0,0,0,0,8192},
{0,0,0,0,0,0,0,0,8192},
{0,0,0,0,0,0,0,0,8192},
{0,0,0,0,0,0,0,4096,0},
{0,0,0,0,0,0,0,0,2048},
{0,0,0,0,0,0,0,0,2048},
{0,0,0,0,0,0,0,0,2048},
{0,0,0,0,0,0,0,1024,0},
{0,0,0,0,0,0,0,0,512},
{0,0,0,0,0,0,0,0,512},
{0,0,0,0,0,0,0,0,512},
{0,0,0,0,0,0,0,256,0},
{0,0,0,0,0,1,0,0,128},
{0,0,0,0,0,1,0,0,128},
{0,0,0,0,2,0,0,0,128},
{0,0,0,0,0,4,0,64,0},
{0,0,0,0,0,4,0,0,32},
{0,0,0,0,0,4,0,0,32},
{4096,0,0,0,8,0,0,0,32},
{4096,0,0,0,0,16,0,16,0},
{2048,0,0,0,0,16,0,0,8},
{0,2048,0,0,0,16,0,0,8},
{0,2048,0,0,32,0,0,0,8},
{0,2048,0,0,0,64,0,0,8},
{0,2048,0,0,0,64,0,4,0},
{0,1024,0,0,0,64,0,0,2},
{0,0,1024,0,128,0,0,0,2},
{0,0,1025,0,128,0,0,8192,2},
{0,2,1024,0,128,0,4096,0,2},
{0,0,1028,64,0,0,0,2048,2},
{0,0,516,0,32,0,0,2048,2},
{0,0,4,512,32,0,0,2048,2},
{128,0,4,512,8224,0,0,2048,2},
{0,64,4,4608,32,0,0,2052,0},
{0,64,4,512,2080,0,0,2048,8},
{0,64,256,8,2080,0,1024,0,8},
{0,64,0,136,2080,0,0,512,8},
{0,64,0,136,2080,0,0,512,8},
{0,64,8192,136,2080,0,0,513,8},
{0,64,8193,8,2336,0,256,1,8200},
{0,64,8193,8,2336,0,256,1,8200},
{4,64,8193,8,2336,0,256,1,8328},
{2052,64,8193,136,2080,0,256,4113,128},
{2052,64,8193,8,2144,0,256,4113,128},
{4,5120,33,8,2144,0,256,4177,0},
{4,1024,2081,8,2144,0,256,4177,0},
{4132,1024,2081,8,2144,8192,256,4177,256},
{4132,1026,2080,0,2161,8192,290,4240,516},
{4388,0,2596,0,2161,8192,290,4240,516},
{4385,8,2596,1026,112,8192,2338,144,516},
{4385,8,2596,0,628,8192,2338,144,516},
{4385,0,10772,64,629,9280,258,144,8708},
{4132,130,10772,64,629,9280,290,384,8228},
{4132,130,10772,320,629,192,4130,384,8228},
{8738,2186,10772,322,8820,193,4194,264,9249},
{8738,2058,576,5226,8948,194,4194,4360,1057},
{8738,2058,576,5226,8948,194,4194,4360,1057},
{1058,4362,9792,5226,8948,2274,98,4354,1056},
{1058,4362,9280,5490,8436,2532,98,2818,8224},
{2122,4610,8420,4976,8948,2548,1130,4866,64},
{2050,658,10468,880,10996,2548,1128,4870,66},
{2050,658,10468,752,10740,3060,1256,4102,1090},
{2066,646,10472,760,10736,3060,1256,4230,1026},
{2050,8974,232,5624,10736,3064,1256,4230,9250},
{2050,8974,232,5624,10736,3064,1512,4118,9218},
{2562,270,5352,5624,11248,3064,1256,4118,9218},
{2050,1038,5864,5624,11248,3064,3304,526,8450},
{2050,9230,4840,6136,11248,4088,1256,526,10498},
{2,9742,4840,6136,10224,4088,744,1550,10242},
{1026,1550,4840,12280,8176,12280,744,9742,10242},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{3074,1550,4840,12280,16368,12280,4840,1550,3074},
{6148,3100,9680,8176,16352,8176,9680,3100,6148},
{12296,6200,2976,16352,16320,16352,2976,6200,12296},
{8208,12400,5952,16320,16256,16320,5952,12400,8208},
{32,8416,11904,16256,16128,16256,11904,8416,32},
{64,448,7424,16128,15872,16128,7424,448,64},
{128,896,14848,15872,15360,15872,14848,896,128},
{256,1792,13312,15360,14336,15360,13312,1792,256},
{512,3584,10240,14336,12288,14336,10240,3584,512},
{1024,7168,4096,12288,8192,12288,4096,7168,1024},
{2048,14336,8192,8192,0,8192,8192,14336,2048},
{4096,12288,0,0,0,0,0,12288,4096},
{8192,8192,0,0,0,0,0,8192,8192},
{0,0,0,0,0,0,0,0,0},
{0,0,0,0,0,0,0,0,0},
{0,0,0,0,0,0,0,0,0},

//FrOSCon Scroll
{8192,8192,8192,8192,8192,8192,8192,8192,8192},
{12288,4096,4096,4096,12288,4096,4096,4096,4096},
{14336,2048,2048,2048,14336,2048,2048,2048,2048},
{15360,1024,1024,1024,15360,1024,1024,1024,1024},
{7680,512,512,512,7680,512,512,512,512},
{3840,256,256,256,3840,8448,8448,8448,8448},
{1920,128,128,128,10112,4224,4224,4224,4224},
{960,64,64,64,13248,2112,2112,2112,2112},
{480,32,32,32,6624,1056,1056,1056,1056},
{240,16,8208,8208,11504,8720,8720,528,528},
{120,8200,12296,12296,5752,4360,12552,8456,264},
{8252,12292,14340,14340,11068,2180,14468,12420,8324},
{12318,6146,7170,15362,13726,1090,7234,6210,12354},
{14351,11265,11777,7681,2767,8737,11809,3105,14369},
{15367,13824,5888,12032,1383,12560,14096,9744,15376},
{7683,15104,11136,14208,691,14472,15240,13064,7688},
{3841,7552,13760,15296,8537,15428,15812,6532,3844},
{1920,3776,6880,7648,4268,7714,7906,3266,1922},
{960,10080,11632,12016,10326,3857,3953,1633,9153},
{8672,5040,5816,6008,9259,1928,1976,816,12768},
{12528,2520,2908,3004,12821,964,988,408,14576},
{14456,1260,1454,1502,14602,482,494,204,15480},
{15420,630,727,751,7301,8433,8439,8294,7740},
{7710,315,363,375,3650,4216,4219,4147,3870},
{3855,157,8373,8379,10017,10300,10301,2073,1935},
{1927,8270,4186,4189,5008,5150,5150,9228,967},
{9155,4135,2093,2094,2504,2575,2575,4614,8675},
{12769,2067,1046,1047,1252,1287,1287,2307,12529},
{14576,1033,523,523,626,643,643,1153,14456},
{7288,8708,261,261,313,321,321,8768,7228},
{3644,4354,130,130,156,160,160,4384,3614},
{1822,2177,65,65,8270,8272,8272,2192,1807},
{911,1088,32,32,8231,4136,4136,5192,9095},
{455,544,16,16,12307,2068,2068,2596,12739},
{227,272,8,8,6153,9226,9226,9490,6369},
{113,136,4,4,3076,4613,4613,4745,3184},
{56,68,2,2,1538,10498,10498,10564,9784},
{28,34,1,1,8961,5249,5249,5282,4892},
{14,17,0,0,12672,2624,2624,2641,2446},
{7,8,0,0,6336,9504,9504,9512,9415},
{3,4,0,0,3168,4752,4752,4756,4707},
{1,2,0,0,1584,2376,2376,2378,2353},
{0,1,0,0,792,1188,1188,1189,1176},
{0,0,0,0,396,594,594,594,588},
{0,0,0,0,198,297,297,297,294},
{0,0,0,0,99,148,148,148,147},
{0,0,0,0,49,74,74,74,73},
{0,0,0,0,24,37,37,37,36},
{0,0,0,0,12,18,18,18,18},
{0,0,0,0,6,9,9,9,9},
{0,0,0,0,3,4,4,4,4},
{0,0,0,0,1,2,2,2,2},
{0,0,0,0,0,1,1,1,1},
{0,0,0,0,0,0,0,0,0},
{0,0,0,0,0,0,0,0,0},
{18000}
};

void setup() {
  LedSign::Init();  //Initializes the screen
}
void loop() {
  DisplayBitMap();  //Displays the bitmap
}

void DisplayBitMap()
{
  boolean run=true;    //While this is true, the screen updates
  byte frame = 0;      //Frame counter
  byte line = 0;       //Row counter
  unsigned long data;  //Temporary storage of the row data

  while(run == true) {
    for(line = 0; line < 9; line++) {

      //Here we fetch data from program memory with a pointer.
      data = pgm_read_word_near (&BitMap[frame][line]);
      
      //Kills the loop if the kill number is found
      if (data==18000){
        run=false;
      }
      
      //This is where the bit-shifting happens to pull out
      //each LED from a row. If the bit is 1, then the LED
      //is turned on, otherwise it is turned off.
      else for (byte led=0; led<14; ++led) {
        if (data & (1<<led)) {
          LedSign::Set(led, line, 1);
        }
        else {
          LedSign::Set(led, line, 0);
        }
      }

    }
    
    //Delays the next update
    delay(blinkdelay);        
    frame++;  
  }
}
